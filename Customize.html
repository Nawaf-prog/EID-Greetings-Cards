<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customize Your Card</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Markazi+Text:wght@450" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="script.js">
    </link>

</head>

<body>

    <div class="name-input">
        <label for="name" class="amiri-regular">اكتب اسمك على الصورة</label>
        <input type="text" id="name">
    </div>
    <button id="preview-btn">معاينة النص</button>
    <canvas id="card-canvas" width="640" height="480"
        style="border:1px solid #000; display: block; margin: 20px auto;"></canvas>
    <button id="save-btn">احفظ الصورة</button>
    <div id="balloon-container">
    </div>
    <script>
        function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split('&');
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split('=');
                if (decodeURIComponent(pair[0]) == variable) {
                    return decodeURIComponent(pair[1]);
                }
            }
            console.error('Design not found in the URL parameters.');
            return false;
        }

        const canvas = document.getElementById('card-canvas');
        const ctx = canvas.getContext('2d');
        const designName = getQueryVariable('design');
        const selectedDesign = designName ? `images/${designName}.jpg` : '';

        function loadImage() {
            const name = document.getElementById('name').value;
            const image = new Image();
            image.onload = function () {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const scaleX = canvas.width / image.width;
                const scaleY = canvas.height / image.height;
                const scaleToFit = Math.min(scaleX, scaleY);
                const offsetX = (canvas.width - (image.width * scaleToFit)) / 2;
                const offsetY = (canvas.height - (image.height * scaleToFit)) / 2;
                ctx.drawImage(image, offsetX, offsetY, image.width * scaleToFit, image.height * scaleToFit);
                ctx.font = '24px Arial';
                ctx.fillStyle = 'black';
                ctx.textAlign = 'center';
                ctx.fillText(name, canvas.width / 2, offsetY + 24); // Adjust if needed
            };
            image.onerror = function () {
                console.error('Error loading the image:', selectedDesign);
            };
            image.src = selectedDesign;
        }

        window.onload = loadImage;

        document.getElementById('preview-btn').addEventListener('click', loadImage);

        document.getElementById('save-btn').addEventListener('click', function () {
            const link = document.createElement('a');
            link.download = 'customized_card.png';
            link.href = canvas.toDataURL();
            link.click();
        });

        const balloonContainer = document.getElementById("balloon-container");

        function random(num) {
            return Math.floor(Math.random() * num);
        }

        function getRandomStyles() {
            var r = random(255);
            var g = random(255);
            var b = random(255);
            var mt = random(200);
            var ml = random(50);
            var dur = random(25) + 5;
            return `
  background-color: rgba(${r},${g},${b},0.7);
  color: rgba(${r},${g},${b},0.7); 
  box-shadow: inset -7px -3px 10px rgba(${r - 10},${g - 10},${b - 10},0.7);
  margin: ${mt}px 0 0 ${ml}px;
  animation: float ${dur}s ease-in infinite
  `;
        }

        function createBalloons(num) {
            for (var i = num; i > 0; i--) {
                var balloon = document.createElement("div");
                balloon.className = "balloon";
                balloon.style.cssText = getRandomStyles();
                balloonContainer.append(balloon);
            }
        }

        function removeBalloons() {
            balloonContainer.style.opacity = 0;
            setTimeout(() => {
                balloonContainer.remove()
            }, 50)
        }

        window.addEventListener("load", () => {
            createBalloons(15)
        });

        window.addEventListener("click", () => {
            removeBalloons();
        });
    </script>

</body>


</html>